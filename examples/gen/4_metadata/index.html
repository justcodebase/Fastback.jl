<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>4. Attach metadata · Fastback.jl</title><meta name="title" content="4. Attach metadata · Fastback.jl"/><meta property="og:title" content="4. Attach metadata · Fastback.jl"/><meta property="twitter:title" content="4. Attach metadata · Fastback.jl"/><meta name="description" content="Documentation for Fastback.jl."/><meta property="og:description" content="Documentation for Fastback.jl."/><meta property="twitter:description" content="Documentation for Fastback.jl."/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><script type="module" defer>
    import { codeToHtml } from 'https://esm.sh/shiki@1.3.0'

    async function highlightCode(lang, el) {
        const code = el.textContent
        if (lang == "julia-repl")
            lang = "julia"
        try {
            el.outerHTML = await codeToHtml(code, {
                lang: lang,
                theme: 'monokai',
                //theme: 'github-light-default',
                //theme: 'github-dark-dimmed',
                //theme: 'dark-plus',
                //themes: {
                //    light: 'github-dark-dimmed',
                //    dark: 'github-dark',
                //}
            })
        } catch (e) {
            console.error(`Failed to highlight code on element with class="${el.classList}" using shiki: `, e)
        }
    }

    document.addEventListener('DOMContentLoaded', async function() {
        console.log('run code highlighting using shiki')
        const els = document.querySelectorAll("code[class^='language-']")
        const promises = []
        for (const el of els) {
            const cls = Array.from(el.classList).filter(x => x.startsWith("language-"))
            if (!cls.length)
                continue
            const lang = cls[0].substring(9)
            el.classList.add('shiki-highlighted')
            
            promises.push(highlightCode(lang, el))
        }
        await Promise.all(promises)
    })
</script>
<link href="../../../assets/styles.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img class="docs-light-only" src="../../../assets/logo.png" alt="Fastback.jl logo"/><img class="docs-dark-only" src="../../../assets/logo-dark.png" alt="Fastback.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../../basic_setup/">Basic setup</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../1_random_trading/">1. Random trading</a></li><li><a class="tocitem" href="../2_portfolio_trading/">2. Portfolio trading</a></li><li><a class="tocitem" href="../3_multi_currency/">3. Multi-Currency trading</a></li><li class="is-active"><a class="tocitem" href>4. Attach metadata</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>4. Attach metadata</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>4. Attach metadata</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/justcodebase/Fastback.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/justcodebase/Fastback.jl/blob/main/docs/src/examples/4_metadata.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Attach-metadata-to-instruments-and-orders"><a class="docs-heading-anchor" href="#Attach-metadata-to-instruments-and-orders">Attach metadata to instruments and orders</a><a id="Attach-metadata-to-instruments-and-orders-1"></a><a class="docs-heading-anchor-permalink" href="#Attach-metadata-to-instruments-and-orders" title="Permalink"></a></h1><p>This example, based on <em>Random trading strategy example</em>, demonstrates how to add metadata to instruments and orders. This is useful for attaching additional information to instruments and orders, such as instrument names, descriptions, or custom attributes, e.g. for storing the signal, strategy, or model that generated the order.</p><p>The type of the metadata can be arbitrarily defined by the user, and is typesafe for best performance.</p><p>The <code>Account</code> type has the following three type parameters:</p><ul><li><code>OData</code>: Order metadata type</li><li><code>IData</code>: Instrument metadata type</li><li><code>CData</code>: Cash metadata type</li></ul><p>by default, these are set to <code>Nothing</code>, but can be customized to any type.</p><p>In this example, we define custom types <code>OData</code> for order metadata, and <code>IData</code> for instrument metadata. The order metadata type <code>OData</code> has a single field <code>probability::Float64</code>, and the instrument metadata type <code>IData</code> has a single field <code>full_name::String</code>.</p><pre><code class="language-julia hljs">using Fastback
using Dates
using Random
using Printf

# set RNG seed for reproducibility
Random.seed!(42);

# metadata type for orders
struct OData
    probability::Float64
end

function Base.show(io::IO, o::OData)
    print(io, @sprintf(&quot;probability=%.2f&quot;, o.probability))
end

# metadata type for instruments
struct IData
    full_name::String
end

function Base.show(io::IO, o::IData)
    print(io, &quot;full_name=$(o.full_name)&quot;)
end

# generate synthetic price series
N = 2_000;
prices = 1000.0 .+ cumsum(randn(N) .+ 0.1);
dts = map(x -&gt; DateTime(2020, 1, 1) + Hour(x), 0:N-1);

# create trading account with $10&#39;000 start capital
acc = Account(; odata=OData, idata=IData);
add_cash!(acc, Cash(:USD), 10_000.0);

# register a dummy instrument
DUMMY = register_instrument!(acc, Instrument(Symbol(&quot;DUMMY/USD&quot;), :DUMMY, :USD;
    metadata=IData(&quot;Dummy instrument name&quot;)));

# data collector for account equity and drawdowns (sampling every hour)
collect_equity, equity_data = periodic_collector(Float64, Hour(1));
collect_drawdown, drawdown_data = drawdown_collector(DrawdownMode.Percentage, Hour(1));

# loop over price series
for (dt, price) in zip(dts, prices)
    # randomly trade with 1% probability
    if rand() &lt; 0.01
        prob = rand()
        quantity = prob &gt; 0.4 ? 1.0 : -1.0
        order = Order(oid!(acc), DUMMY, dt, price, quantity; metadata=OData(prob))
        fill_order!(acc, order, dt, price; fill_qty=0.75order.quantity, commission_pct=0.001)
    end

    # update position and account P&amp;L
    update_pnl!(acc, DUMMY, price)

    # collect data for plotting
    if should_collect(equity_data, dt)
        equity_value = equity(acc, :USD)
        collect_equity(dt, equity_value)
        collect_drawdown(dt, equity_value)
    end
end</code></pre><h3 id="Print-instrument-incl.-metadata-to-console"><a class="docs-heading-anchor" href="#Print-instrument-incl.-metadata-to-console">Print instrument incl. metadata to console</a><a id="Print-instrument-incl.-metadata-to-console-1"></a><a class="docs-heading-anchor-permalink" href="#Print-instrument-incl.-metadata-to-console" title="Permalink"></a></h3><p>Note that at the end, <code>metadata</code> is printed based on the <code>show</code> method defined above for <code>IData</code> type.</p><pre><code class="language-julia hljs">show(DUMMY)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[Instrument] symbol=DUMMY/USD base=DUMMY [-Inf, Inf]±0.01 quote=USD±0.01 metadata=full_name=Dummy instrument name</code></pre><h3 id="Print-account-summary-incl.-metadata-to-console"><a class="docs-heading-anchor" href="#Print-account-summary-incl.-metadata-to-console">Print account summary incl. metadata to console</a><a id="Print-account-summary-incl.-metadata-to-console-1"></a><a class="docs-heading-anchor-permalink" href="#Print-account-summary-incl.-metadata-to-console" title="Permalink"></a></h3><p>Note that at the end of the <strong>Trades</strong> table, a <strong>Metadata</strong> column is shown based on the <code>show</code> method defined above for <code>OData</code> type.</p><pre><code class="language-julia hljs">show(acc)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ ACCOUNT SUMMARY ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
<span class="sgr1">Cash balances</span> (1)
┌─────┬──────────┐
│     │    Value │
├─────┼──────────┤
│ USD │ 10140.65 │
└─────┴──────────┘

<span class="sgr1">Equity balances</span> (1)
┌─────┬──────────┐
│     │    Value │
├─────┼──────────┤
│ USD │ 10260.77 │
└─────┴──────────┘

<span class="sgr1">Positions</span> (1)
┌───────────┬──────────┬────────────┬─────┬────────┐
│    Symbol │ Quantity │ Avg. price │ Ccy │    P&amp;L │
├───────────┼──────────┼────────────┼─────┼────────┤
│ DUMMY/USD │     3.25 │    1086.99 │ USD │ 120.11 │
└───────────┴──────────┴────────────┴─────┴────────┘

<span class="sgr1">Trades</span> (23)
┌────┬───────────┬─────────────────────┬──────────┬──────────┬─────────────┬────────────┬─────┬──────────────┬───────┬──────────────────┐
│ ID │    Symbol │                Date │ Quantity │ Fill qty │ Remain. qty │ Fill price │ Ccy │ Realized P&amp;L │ Comm. │         Metadata │
├────┼───────────┼─────────────────────┼──────────┼──────────┼─────────────┼────────────┼─────┼──────────────┼───────┼──────────────────┤
│  1 │ DUMMY/USD │ 2020-01-01 03:00:00 │     1.00 │     0.75 │        0.25 │     999.66 │ USD │        -0.75 │  0.75 │ probability=0.79 │
│  2 │ DUMMY/USD │ 2020-01-05 02:00:00 │     1.00 │     0.75 │        0.25 │    1004.04 │ USD │        -0.75 │  0.75 │ probability=0.48 │
│  3 │ DUMMY/USD │ 2020-01-07 18:00:00 │     1.00 │     0.75 │        0.25 │    1005.23 │ USD │        -0.75 │  0.75 │ probability=0.92 │
│  4 │ DUMMY/USD │ 2020-01-10 04:00:00 │    -1.00 │    -1.00 │        0.00 │    1014.50 │ USD │        12.54 │ -1.01 │ probability=0.14 │
│  5 │ DUMMY/USD │ 2020-01-14 05:00:00 │     1.00 │     0.75 │        0.25 │    1005.24 │ USD │        -0.75 │  0.75 │ probability=0.50 │
│  6 │ DUMMY/USD │ 2020-01-16 05:00:00 │    -1.00 │    -1.00 │        0.00 │     998.26 │ USD │        -4.57 │ -1.00 │ probability=0.17 │
│  7 │ DUMMY/USD │ 2020-01-16 18:00:00 │     1.00 │     0.75 │        0.25 │     998.62 │ USD │        -0.75 │  0.75 │ probability=0.96 │
│  8 │ DUMMY/USD │ 2020-01-18 03:00:00 │     1.00 │     0.75 │        0.25 │    1002.23 │ USD │        -0.75 │  0.75 │ probability=0.61 │
│  9 │ DUMMY/USD │ 2020-01-18 10:00:00 │    -1.00 │    -1.00 │        0.00 │    1003.12 │ USD │         2.34 │ -1.00 │ probability=0.18 │
│ 10 │ DUMMY/USD │ 2020-01-19 02:00:00 │    -1.00 │    -1.00 │        0.00 │    1007.68 │ USD │         6.90 │ -1.01 │ probability=0.34 │
│ 11 │ DUMMY/USD │ 2020-01-30 02:00:00 │     1.00 │     0.75 │        0.25 │    1014.10 │ USD │        -0.76 │  0.76 │ probability=0.98 │
│ 12 │ DUMMY/USD │ 2020-02-03 14:00:00 │     1.00 │     0.75 │        0.25 │    1026.44 │ USD │        -0.77 │  0.77 │ probability=0.78 │
│ 13 │ DUMMY/USD │ 2020-02-10 16:00:00 │     1.00 │     0.75 │        0.25 │    1039.42 │ USD │        -0.78 │  0.78 │ probability=0.65 │
│ 14 │ DUMMY/USD │ 2020-02-12 20:00:00 │     1.00 │     0.75 │        0.25 │    1050.59 │ USD │        -0.79 │  0.79 │ probability=0.90 │
│ 15 │ DUMMY/USD │ 2020-02-27 17:00:00 │     1.00 │     0.75 │        0.25 │    1049.16 │ USD │        -0.79 │  0.79 │ probability=0.57 │
│ 16 │ DUMMY/USD │ 2020-02-27 23:00:00 │    -1.00 │    -1.00 │        0.00 │    1044.86 │ USD │        13.98 │ -1.04 │ probability=0.26 │
│ 17 │ DUMMY/USD │ 2020-03-04 21:00:00 │    -1.00 │    -1.00 │        0.00 │    1069.05 │ USD │        38.20 │ -1.07 │ probability=0.14 │
│ 18 │ DUMMY/USD │ 2020-03-07 17:00:00 │    -1.00 │    -1.00 │        0.00 │    1076.76 │ USD │        45.92 │ -1.08 │ probability=0.33 │
│ 19 │ DUMMY/USD │ 2020-03-10 02:00:00 │     1.00 │     0.75 │        0.25 │    1090.97 │ USD │        -0.82 │  0.82 │ probability=0.84 │
│ 20 │ DUMMY/USD │ 2020-03-18 04:00:00 │     1.00 │     0.75 │        0.25 │    1113.01 │ USD │        -0.83 │  0.83 │ probability=0.66 │
│ 21 │ DUMMY/USD │ 2020-03-18 23:00:00 │     1.00 │     0.75 │        0.25 │    1114.18 │ USD │        -0.84 │  0.84 │ probability=0.47 │
│ 22 │ DUMMY/USD │ 2020-03-22 17:00:00 │     1.00 │     0.75 │        0.25 │    1121.58 │ USD │        -0.84 │  0.84 │ probability=0.42 │
│ 23 │ DUMMY/USD │ 2020-03-23 00:00:00 │    -1.00 │    -1.00 │        0.00 │    1122.93 │ USD │        37.07 │ -1.12 │ probability=0.19 │
└────┴───────────┴─────────────────────┴──────────┴──────────┴─────────────┴────────────┴─────┴──────────────┴───────┴──────────────────┘
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../3_multi_currency/">« 3. Multi-Currency trading</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.4.0 on <span class="colophon-date" title="Tuesday 27 August 2024 13:05">Tuesday 27 August 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
